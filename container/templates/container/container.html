{% extends "container/base.html" %}
{% block content %}

    <h2>ğŸ“¦ Container Page</h2>
    <p>This is Container Information</p>
    
    <div class="mb-3">
        <a href="{% url 'add_container_view' %}" class="btn btn-primary">
            <i class="fas fa-plus"></i> Add Container
        </a>
    </div>

    <div class="table-container">
        <table class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Container ID</th>
                    <th>File Name</th>
                    <th>Content</th>
                    <th>Created At</th>
                    <th>Railway Date</th>
                    <th>Pickup Date</th>
                    <th>Delivery Date</th>
                    <th>Empty Date</th>
                    <th>Pickup Number</th>
                </tr>
            </thead>
            <tbody>
                {% for container in containers %}
                <tr>
                    <td>{{ container.id }}</td>
                    <td>
                        <a href="{% url 'edit_container' container.container_id %}">{{ container.container_id }}</a>
                    </td>
                    <td>{{ container.container_pdfname }}</td>
                    <td>{{ container.content }}</td>
                    <td>{{ container.created_at |date:"m/d/Y" }}</td>
                    <td>{{ container.railway_date |date:"m/d/Y" }}</td>
                    <td>{{ container.pickup_date |date:"m/d/Y" }}</td>
                    <td>{{ container.delivery_date |date:"m/d/Y" }}</td>
                    <td>{{ container.empty_date |date:"m/d/Y" }}</td>
                    <td>{{ container.pickup_number }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            document.getElementById("add-container-form").onsubmit = function(event) {
                event.preventDefault();
                
                let formData = new FormData();
                formData.append("container_id", document.getElementById("container-id").value);
                formData.append("pickup_number", document.getElementById("pickup-number").value);
                
                // æ·»åŠ æ—¥æœŸå­—æ®µ
                const dateFields = ["railway-date", "pickup-date", "delivery-date", "empty-date"];
                dateFields.forEach(field => {
                    const value = document.getElementById(field).value;
                    if (value) {
                        formData.append(field.replace("-", "_"), value);
                    }
                });
                
                // æ·»åŠ PDFæ–‡ä»¶
                const containerPdf = document.getElementById("container-pdf").files[0];
                if (containerPdf) {
                    formData.append("container_pdf", containerPdf);
                }
    
                fetch("{% url 'add_container' %}", {
                    method: "POST",
                    body: formData,
                    headers: {
                        "X-CSRFToken": "{{ csrf_token }}"
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert("âŒ Save failed: " + data.error);
                    } else {
                        alert("âœ… Container saved successfully!");
                        window.location.href = "{% url 'container' %}";  // ä¿å­˜æˆåŠŸåè¿”å›åˆ—è¡¨é¡µ
                    }
                })
                .catch(error => {
                    console.error("Error:", error);
                    alert("âŒ An error occurred while saving the container.");
                });
            };
        });
    </script>

{% endblock %}

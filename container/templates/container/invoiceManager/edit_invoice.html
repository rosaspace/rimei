{% extends "container/base.html" %}
{% block content %}
<h2>🧾 Edit Invoice</h2>

<!-- 添加自定义样式 -->
<style>
    .info-section, .email-section, #invoice-form {
        background-color: #f1f3f5;  /* 更深的灰色背景 */
        border: 2px solid #ced4da !important;  /* 更深的边框颜色 */
        border-radius: 6px;  /* 稍微增加圆角 */
    }
    .info-section {
        box-shadow: 0 2px 4px rgba(0,0,0,0.15);  /* 增强阴影效果 */
    }
    .left-info, .right-info {
        padding: 12px;  /* 增加内边距 */
    }
    .left-info p, .right-info p {
        margin-bottom: 0.5rem;
        color: #495057;
    }
    strong {
        color: #212529;
    }
    /* 添加边框悬停效果 */
    .info-section:hover, .email-section:hover, #invoice-form:hover {
        border-color: #adb5bd !important;
        box-shadow: 0 3px 6px rgba(0,0,0,0.18);
    }
</style>

<!-- Information Section -->
<div class="info-section mb-4 border p-3 rounded">
    <div class="d-flex justify-content-between">
        <div class="left-info">
            <p>Container ID: <strong>{{ container_id }}</strong></p> <!-- 显示 Container ID -->
            <p>Container File Name: <strong>{{ container.container_pdfname }}</strong></p>
            <p>Pickup Number: <strong>{{ container.pickup_number }}</strong></p>
            <p>Invoice ID: <strong>{{ container.invoice_id }}</strong></p>
            <p>Invoice File Name: <strong>{{ container.invoice_pdfname }}</strong></p>
        </div>
        <div class="right-info">
            <p>Railway Date: <strong>{{ container.railway_date }}</strong></p>
            <p>Pickup Date: <strong>{{ container.pickup_date }}</strong></p>
            <p>Delivery Date: <strong>{{ container.delivery_date }}</strong></p>
            <p>Empty Date: <strong>{{ container.empty_date }}</strong></p>
            <p>Created At: <strong>{{ container.created_at }}</strong></p>
        </div>
    </div>
</div>

<!-- Functionality Section -->
<div>
    <form id="invoice-form" enctype="multipart/form-data" class="border p-3 rounded mb-4">
        <div class="mb-3">
            <label for="invoice-file" class="form-label">Upload Invoice PDF</label>
            <input type="file" id="invoice-file" name="invoice_file" accept="application/pdf" required>
        </div>
        <button type="submit" class="btn btn-primary">Upload Invoice</button>
        <a href="{% url 'invoice' %}" class="btn btn-secondary ms-2">Back</a>
    </form>
</div>

{% endblock %}

<script>
    document.addEventListener("DOMContentLoaded", function() {
        document.getElementById("invoice-form").onsubmit = function (event) {
            event.preventDefault();  // Prevent the default form submission
            let fileInput = document.getElementById("invoice-file").files[0];

            if (!fileInput) {
                alert("Please select an invoice PDF file first.");
                return;
            }

            let formData = new FormData();
            formData.append("invoice_file", fileInput);

            fetch("{% url 'edit_invoice' container.container_id %}", {
                method: "POST",
                body: formData,
                headers: {
                    "X-CSRFToken": "{{ csrf_token }}"
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert("❌ Upload failed: " + data.error);
                } else {
                    document.getElementById("invoice-address").innerText = data.address;
                    document.getElementById("invoice-date").innerText = data.date;
                    document.getElementById("invoice-amount").innerText = data.amount;
                    document.getElementById("result").style.display = "block";
                }
            })
            .catch(error => {
                alert("❌ An error occurred: " + error);
            });
        };
    });
</script>
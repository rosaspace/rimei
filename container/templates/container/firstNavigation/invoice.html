{% extends "container/base.html" %}

{% block content %}
<!-- 同一行容器 -->
<div class="d-flex flex-wrap align-items-center w-100  mb-2">
    <!-- 左侧 -->
    <div class="me-auto">
        <a href="{% url 'statement_by_filter' %}?{{ request.GET.urlencode }}"
            class="btn btn-success ms-2">
            Generate Statement
        </a>
    </div>

    <!-- 右侧过滤（GET 表单） -->
    <form method="get" class="d-flex align-items-center">
        <!-- Customer -->
        <select name="customer" class="form-select me-2"
                onchange="this.form.submit()" style="width:180px;">
            <option value="">All Customers</option>
            {% for c in customers %}
                <option value="{{ c.id }}"
                    {% if request.GET.customer == c.id|stringformat:"s" %}selected{% endif %}>
                    {{ c.name }}
                </option>
            {% endfor %}
        </select>

        <!-- Logistics -->
        <select name="logistics" class="form-select me-2"
                onchange="this.form.submit()" style="width:180px;">
            <option value="">All Logistics</option>
            {% for l in logistics_list %}
                <option value="{{ l.id }}"
                    {% if request.GET.logistics == l.id|stringformat:"s" %}selected{% endif %}>
                    {{ l.name }}
                </option>
            {% endfor %}
        </select>

        <!-- 未付款（公司） -->
        <select name="ispay" class="form-select me-2"
                onchange="this.form.submit()" style="width:160px;">
            <option value="">Company Pay</option>
            <option value="false" {% if request.GET.ispay == "false" %}selected{% endif %}>
                Unpaid
            </option>
        </select>

        <!-- 客户未付款 -->
        <select name="customer_ispay" class="form-select"
                onchange="this.form.submit()" style="width:170px;">
            <option value="">Customer Pay</option>
            <option value="false" {% if request.GET.customer_ispay == "false" %}selected{% endif %}>
                Unpaid
            </option>
        </select>
    </form>
</div>

<hr class="my-2 border-1 opacity-100">

<!-- invoice container table -->
<div class="table-container">
    <table class="table table-striped table-bordered table-hover">
        <thead>
            <tr>
                <th></th>
                <th>ID</th>
                <th>Container#</th>
                <th>Customer</th>
                <th>Logistics</th>
                <th>Delivery Date</th>
                <th>Invoice#</th>
                <th>Price</th>
                <th>Invoice Date</th>
                <th>Due Date</th>
                <th>Pay Date</th>
                <th>Pay</th>
                <th>Invoice#</th>
                <th>Price</th>
                <th>Invoice Date</th>
                <th>Due Date</th>
                <th>Pay Date</th>
                <th>Pay</th>
            </tr>
        </thead>
        <tbody>
            {% for container in containers %}
            <tr data-container-id="{{ container.container_id }}">
                <td><input type="checkbox" name="selected_ids" value="{{ container.container_id }}"></td>
                <td>{{ container.id }}</td>
                <td>
                    {% if container.container_id %}
                        <a href="{% url 'edit_invoice' container.container_id %}">{{ container.container_id }}</a>
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>{{ container.customer.name }}</td>
                <td>{{ container.logistics.name }}</td>
                <td>{{ container.delivery_date |date:"m/d/Y"}}</td>
                <td>{{ container.invoice_id }}</td>
                <!-- <td>{{ container.invoice_pdfname }}</td> -->
                <td>{{ container.price }}</td>
                <td>{{ container.invoice_date |date:"m/d/Y"}}</td>
                <td>{{ container.due_date |date:"m/d/Y"}}</td>
                <td>{{ container.payment_date |date:"m/d/Y"}}</td>
                <td class="text-center">
                    {% if container.ispay %}
                    <i class="fas fa-check-circle text-success" style="font-size: 1.2em;"></i>
                    {% else %}
                    <i class="far fa-circle text-muted" style="font-size: 1.2em;"></i>
                    {% endif %}
                </td>

                <td>
                    {% if container.customer.id != 3 and container.customer.id != 12 %}
                        {{ container.customer_invoiceId }}
                    {% else %}
                        <!-- or leave blank -->
                        -
                    {% endif %}
                </td>
                <td>
                    {% if container.customer.id != 3 and container.customer.id != 12 %}
                        {{ container.customer_price }}
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>
                    {% if container.customer.id != 3 and container.customer.id != 12 %}
                        {{ container.customer_invoice_date|date:"m/d/Y" }}
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>
                    {% if container.customer.id != 3 and container.customer.id != 12 %}
                        {{ container.customer_due_date|date:"m/d/Y" }}
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>
                    {% if container.customer.id != 3 and container.customer.id != 12 %}
                        {{ container.customer_payment_date|date:"m/d/Y" }}
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td class="text-center">
                    {% if container.customer.id != 3 and container.customer.id != 12 %}
                        {% if container.customer_ispay %}
                        <i class="fas fa-check-circle text-success" style="font-size: 1.2em;"></i>
                        {% else %}
                        <i class="far fa-circle text-muted"  style="font-size: 1.2em;"></i>
                        {% endif %}
                    {% else %}
                        -
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}


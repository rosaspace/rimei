{% extends "container/base.html" %}

{% block content %}

<form method="post" id="statementForm" action="{% url 'statement_selected_invoices' %}">
    {% csrf_token %}

    {% for container in containers %}
        <input type="hidden" name="page_container_ids" value="{{ container.container_id }}">
    {% endfor %}

    <input type="hidden" name="search_keyword" id="searchKeyword">

    <!-- 同一行容器 -->
    <div class="d-flex align-items-center mb-2">

        <div class="form-check me-3">
            <input class="form-check-input" type="checkbox" name="isselectall" value="true" id="selectAll">
            <label class="form-check-label" for="selectAll">
                Select all containers
            </label>
        </div>

        <button type="submit" class="btn btn-primary">
            Generate Statement
        </button>
    </div>

    <hr class="my-2 border-1 opacity-100">

    <!-- table -->
    <div class="table-container">
        <table class="table table-striped table-bordered table-hover">
            <thead>
                <tr>
                    <th></th>
                    <th>ID</th>
                    <th>Container#</th>
                    <th>Customer</th>
                    <th>Logistics</th>
                    <th>Delivery Date</th>
                    <th>Invoice#</th>
                    <th>Price</th>
                    <th>Invoice Date</th>
                    <th>Due Date</th>
                    <th>Pay Date</th>
                    <th>Pay</th>
                    <th>Invoice#</th>
                    <th>Price</th>
                    <th>Invoice Date</th>
                    <th>Due Date</th>
                    <th>Pay Date</th>
                    <th>Pay</th>
                </tr>
            </thead>
            <tbody>
                {% for container in containers %}
                <tr data-container-id="{{ container.container_id }}">
                    <td><input type="checkbox" name="selected_ids" value="{{ container.container_id }}"></td>
                    <td>{{ container.id }}</td>
                    <td>
                        {% if container.container_id %}
                            <a href="{% url 'edit_invoice' container.container_id %}">{{ container.container_id }}</a>
                        {% else %}
                            N/A
                        {% endif %}
                    </td>
                    <td>{{ container.customer.name }}</td>
                    <td>{{ container.logistics.name }}</td>
                    <td>{{ container.delivery_date |date:"m/d/Y"}}</td>
                    <td>{{ container.invoice_id }}</td>
                    <!-- <td>{{ container.invoice_pdfname }}</td> -->
                    <td>{{ container.price }}</td>
                    <td>{{ container.invoice_date |date:"m/d/Y"}}</td>
                    <td>{{ container.due_date |date:"m/d/Y"}}</td>
                    <td>{{ container.payment_date |date:"m/d/Y"}}</td>
                    <td class="text-center">
                        {% if container.ispay %}
                        <i class="fas fa-check-circle text-success" style="font-size: 1.2em;"></i>
                        {% else %}
                        <i class="far fa-circle text-muted" style="font-size: 1.2em;"></i>
                        {% endif %}
                    </td>

                    <td>
                        {% if container.customer.id != 3 and container.customer.id != 12 %}
                            {{ container.customer_invoiceId }}
                        {% else %}
                            <!-- or leave blank -->
                            -
                        {% endif %}
                    </td>
                    <td>
                        {% if container.customer.id != 3 and container.customer.id != 12 %}
                            {{ container.customer_price }}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>
                        {% if container.customer.id != 3 and container.customer.id != 12 %}
                            {{ container.customer_invoice_date|date:"m/d/Y" }}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>
                        {% if container.customer.id != 3 and container.customer.id != 12 %}
                            {{ container.customer_due_date|date:"m/d/Y" }}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>
                        {% if container.customer.id != 3 and container.customer.id != 12 %}
                            {{ container.customer_payment_date|date:"m/d/Y" }}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td class="text-center">
                        {% if container.customer.id != 3 and container.customer.id != 12 %}
                            {% if container.customer_ispay %}
                            <i class="fas fa-check-circle text-success" style="font-size: 1.2em;"></i>
                            {% else %}
                            <i class="far fa-circle text-muted"  style="font-size: 1.2em;"></i>
                            {% endif %}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</form>

{% endblock %}

{% block script %}
<script>
    document.addEventListener("DOMContentLoaded", function () {
      
        // 实时获取所有单个 checkbox
        function getItemCheckboxes() {
            return document.querySelectorAll('input[name="selected_ids"]');
        }

        // 注册 toggle 按钮点击事件
        const toggleBtn = document.getElementById("toggle-selection-btn");
        if (toggleBtn) {
            toggleBtn.addEventListener("click", function () {
                const checkboxes = getItemCheckboxes();
                checkboxes.forEach(cb => cb.checked = !cb.checked);
            });
        }
    });
</script>

{% endblock %}

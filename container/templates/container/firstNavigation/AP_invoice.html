{% extends "container/base.html" %}

{% block content %}
<div class="d-flex flex-wrap align-items-center w-100  mb-2">
    <!-- 左侧：新增按钮 -->
    <div class="me-auto">
        <a href="{% url 'add_ap_invoice' %}" class="btn btn-primary">
            <i class="fas fa-plus"></i> Add Payable Invoice
        </a>
    </div>

    <!-- 右侧：Vendor / Company 下拉框 -->
    <form method="get" class="d-flex align-items-center">
        <!-- Vendor -->
        <select name="vendor" class="form-select me-2"
                onchange="this.form.submit()"
                style="width: 180px;">
            <option value="">All Vendors</option>
            {% for v in vendors %}
                <option value="{{ v.id }}"
                    {% if request.GET.vendor == v.id|stringformat:"s" %}selected{% endif %}>
                    {{ v.name }}
                </option>
            {% endfor %}
        </select>

        <!-- Company -->
        <select name="company" class="form-select"
                onchange="this.form.submit()"
                style="width: 150px;">
            <option value="">All Companies</option>
            {% for c in companies %}
                <option value="{{ c.id }}"
                    {% if request.GET.company == c.id|stringformat:"s" %}selected{% endif %}>
                    {{ c.shortname }}
                </option>
            {% endfor %}
        </select>
    </form>
</div>
<div class="table-container">
    <table class="table table-striped table-bordered table-hover">
        <thead>
            <tr>
                <th>Name</th>
                <th>Invoice#</th>
                <th>Price</th>
                <th>Company</th>
                <th>DueDate</th>
                <th>BossDate</th>
                <th>PayDate</th>
                <th>PurposeFor</th>
                <th>Note</th>
                <th>PDF</th>
                <th>Delete</th>
            </tr>
        </thead>
        <tbody>
            {% for item in apRecord %}
            <tr>
                <td>{{ item.vendor.name }}</td>
                <td>
                    <a href="{% url 'edit_ap_invoice' item.invoice_id %}" class="text-primary text-decoration-underline">
                        {{ item.invoice_id }}
                    </a>
                </td>
                <td>$ {{ item.invoice_price }}</td>
                <td>{{ item.company.shortname }}</td>
                <td>{{ item.due_date |date:"m/d/Y"}}</td>
                <td>{{ item.givetoboss_date |date:"m/d/Y"}}</td>
                <td>{{ item.payment_date |date:"m/d/Y"}}</td>
                <td>{{ item.purposefor.name |default:""}}</td>
                <td>{{ item.note }}</td> 
                <td><a href="{% url 'print_original_ap_invoice' item.invoice_id %}">{{ item.ar_invoice_pdfname |default:""}}</a></td>
                <td><a href="{% url 'delete_ap_invoice' item.invoice_id %}" class="text-danger text-decoration-underline">Delete</a></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}